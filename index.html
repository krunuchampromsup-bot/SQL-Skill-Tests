<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ฝึก SQL : VIEW</title>
<script src="sql-wasm.js"></script>
<style>
body { font-family: sans-serif; padding: 20px; }
textarea { width: 100%; height: 100px; }
button { padding: 10px 20px; margin-top: 10px; }
.result { margin-top: 15px; font-weight: bold; }
</style>
</head>

<body>
<h2>แบบฝึก SQL : การใช้ VIEW</h2>

<p><b>โจทย์:</b> สร้าง VIEW ชื่อ <code>view_student_score</code></p>

<textarea id="sqlInput" placeholder="พิมพ์คำสั่ง SQL ที่นี่"></textarea>
<br>
<button onclick="runSQL()">ตรวจคำตอบ</button>

<div class="result" id="result"></div>

<script>
let db;

initSqlJs({ locateFile: file => file })
.then(SQL => {
  db = new SQL.Database();

  // สร้างตาราง
  db.run(`
    CREATE TABLE student (id INTEGER, name TEXT);
    CREATE TABLE class (id INTEGER, name TEXT);
    CREATE TABLE score (student_id INTEGER, class_id INTEGER, score INTEGER);

    INSERT INTO student VALUES (1,'สมชาย'),(2,'สมหญิง');
    INSERT INTO class VALUES (101,'ฐานข้อมูล');
    INSERT INTO score VALUES (1,101,80),(2,101,90);
  `);
});

function runSQL() {
  let userSQL = document.getElementById("sqlInput").value;

  try {
    db.run(userSQL);

    // ตรวจว่า VIEW ถูกสร้างหรือไม่
    let check = db.exec(
      "SELECT name FROM sqlite_master WHERE type='view' AND name='view_student_score';"
    );

    if (check.length > 0) {
      document.getElementById("result").innerHTML = "✅ ถูกต้อง ได้คะแนน 10/10";
    } else {
      document.getElementById("result").innerHTML = "❌ ยังไม่พบ VIEW ที่กำหนด";
    }
  } catch (err) {
    document.getElementById("result").innerHTML = "❌ SQL ผิดพลาด";
  }
}
</script>
</body>
</html>
